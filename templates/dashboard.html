{# dashboard#}
{# {% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<h2 class="mb-4">üìä Dashboard</h2>

<!-- Budget Alert -->
{% if alert %}
    <div class="alert alert-danger">
        ‚ö†Ô∏è Budget Exceeded! You spent ‚Çπ{{ total_expenses }} / Budget ‚Çπ{{ budget }}
    </div>
{% else %}
    <div class="alert alert-success">
        ‚úÖ Total spending ‚Çπ{{ total_expenses }} / Budget ‚Çπ{{ budget }}
    </div>
{% endif %}

<div class="row mb-4">
    <!-- Pie Chart -->
    <div class="col-md-6">
        <canvas id="pieChart"></canvas>
    </div>

    <!-- Bar Chart -->
    <div class="col-md-6">
        <canvas id="barChart"></canvas>
    </div>
</div>

<!-- Summary Card -->
<div class="card p-3 shadow-sm mb-4">
    <h4>Total Expenses: ‚Çπ{{ total_expenses }}</h4>
    <p>Number of Entries: {{ count }}</p>
    <a href="{{ url_for('main.add_expense') }}" class="btn btn-primary">
        <i class="fa fa-plus"></i> Add Expense
    </a>
</div>

<!-- Expense Table -->
<div class="card shadow-sm p-3 mt-4">
    <h4 class="mb-3">üí∞ Expense List</h4>
    {% if expenses %}
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Amount (‚Çπ)</th>
                    <th>Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for expense in expenses %}
                <tr>
                    <td>{{ expense.category }}</td>
                    <td>{{ expense.amount }}</td>
                    <td>{{ expense.date.strftime("%Y-%m-%d") }}</td>
                    <td>
                        <a href="{{ url_for('main.edit_expense', expense_id=expense.id) }}" 
                           class="btn btn-warning btn-sm">‚úèÔ∏è Edit</a>
                        <a href="{{ url_for('main.delete_expense', expense_id=expense.id) }}" 
                           class="btn btn-danger btn-sm" 
                           onclick="return confirm('Are you sure you want to delete this expense?')">üóëÔ∏è Delete</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="alert alert-info">No expenses found. Start by adding one!</div>
    {% endif %}
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const categories = {{ categories | safe }};
const amounts = {{ amounts | safe }};

// Pie Chart (category-wise %)
new Chart(document.getElementById('pieChart'), {
    type: 'pie',
    data: {
        labels: categories,
        datasets: [{
            data: amounts,
            backgroundColor: [
                'rgba(255, 99, 132, 0.7)',
                'rgba(54, 162, 235, 0.7)',
                'rgba(255, 206, 86, 0.7)',
                'rgba(75, 192, 192, 0.7)',
                'rgba(153, 102, 255, 0.7)',
                'rgba(255, 159, 64, 0.7)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: { legend: { position: 'bottom' } }
    }
});

// Bar Chart (category-wise amount)
new Chart(document.getElementById('barChart'), {
    type: 'bar',
    data: {
        labels: categories,
        datasets: [{
            label: 'Expenses (‚Çπ)',
            data: amounts,
            backgroundColor: 'rgba(54, 162, 235, 0.7)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1,
            borderRadius: 5
        }]
    },
    options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
    }
});
</script>
{% endblock %} #}

{# dashboard.html #}
{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<h2 class="mb-4">üìä Dashboard</h2>

<!-- Budget Update Form -->
<form action="{{ url_for('main.update_budget') }}" method="POST" class="mb-3 d-flex">
  <input type="number" step="0.01" name="budget" class="form-control me-2" placeholder="Enter new budget" required>
  <button type="submit" class="btn btn-success">Update Budget</button>
</form>


<!-- Budget Alert -->
{% if alert %}
    <div class="alert alert-danger">
        ‚ö†Ô∏è Budget Exceeded! You spent ‚Çπ{{ total_expenses }} / Budget ‚Çπ{{ budget }}
    </div>
{% else %}
    <div class="alert alert-success">
        ‚úÖ Total spending ‚Çπ{{ total_expenses }} / Budget ‚Çπ{{ budget }}
    </div>
{% endif %}

<!-- Action Buttons -->
<div class="mb-4">
    <a href="{{ url_for('main.add_expense') }}" class="btn btn-primary">
        ‚ûï Add Expense
    </a>
    <a href="{{ url_for('main.export_csv') }}" class="btn btn-outline-primary">
        ‚¨áÔ∏è Export CSV
    </a>
    <a href="{{ url_for('main.export_excel') }}" class="btn btn-outline-success">
        ‚¨áÔ∏è Export Excel
    </a>
    <a href="{{ url_for('main.upload_csv') }}" class="btn btn-outline-warning">
        üì§ Upload CSV
    </a>
</div>

<div class="row mb-4">
    <!-- Pie Chart -->
    <div class="col-md-6">
        <canvas id="pieChart"></canvas>
    </div>

    <!-- Bar Chart -->
    <div class="col-md-6">
        <canvas id="barChart"></canvas>
    </div>
</div>

<!-- Summary Card -->
<div class="card p-3 shadow-sm mb-4">
    <h4>Total Expenses: ‚Çπ{{ total_expenses }}</h4>
    <p>Number of Entries: {{ count }}</p>
</div>

<!-- Date Filter -->
<form method="GET" action="{{ url_for('main.dashboard') }}" class="mb-3 d-flex">
  <input type="date" name="start_date" value="{{ start_date or '' }}" class="form-control me-2">
  <input type="date" name="end_date" value="{{ end_date or '' }}" class="form-control me-2">
  <button type="submit" class="btn btn-info">Filter</button>
</form>


<!-- Expense Table -->
<div class="card shadow-sm p-3 mt-4">
    <h4 class="mb-3">üí∞ Expense List</h4>
    {% if expenses %}
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Amount (‚Çπ)</th>
                    <th>Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for expense in expenses %}
                <tr>
                    <td>{{ expense.category }}</td>
                    <td>{{ expense.amount }}</td>
                    <td>{{ expense.date.strftime("%Y-%m-%d") }}</td>
                    <td>
                        <a href="{{ url_for('main.edit_expense', expense_id=expense.id) }}" 
                           class="btn btn-warning btn-sm">‚úèÔ∏è Edit</a>
                        <a href="{{ url_for('main.delete_expense', expense_id=expense.id) }}" 
                           class="btn btn-danger btn-sm" 
                           onclick="return confirm('Are you sure you want to delete this expense?')">üóëÔ∏è Delete</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="alert alert-info">No expenses found. Start by adding one!</div>
    {% endif %}
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const categories = {{ categories | safe }};
const amounts = {{ amounts | safe }};

// Pie Chart (category-wise %)
new Chart(document.getElementById('pieChart'), {
    type: 'pie',
    data: {
        labels: categories,
        datasets: [{
            data: amounts,
            backgroundColor: [
                'rgba(255, 99, 132, 0.7)',
                'rgba(54, 162, 235, 0.7)',
                'rgba(255, 206, 86, 0.7)',
                'rgba(75, 192, 192, 0.7)',
                'rgba(153, 102, 255, 0.7)',
                'rgba(255, 159, 64, 0.7)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: { legend: { position: 'bottom' } }
    }
});

// Bar Chart (category-wise amount)
new Chart(document.getElementById('barChart'), {
    type: 'bar',
    data: {
        labels: categories,
        datasets: [{
            label: 'Expenses (‚Çπ)',
            data: amounts,
            backgroundColor: 'rgba(54, 162, 235, 0.7)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1,
            borderRadius: 5
        }]
    },
    options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
    }
});
</script>
{% endblock %}







